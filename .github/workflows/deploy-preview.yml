name: Deploy (preview)

on:
  pull_request:
    branches: [main]
    types: [opened, synchronize, reopened]

concurrency:
  group: deploy-preview-${{ github.event.pull_request.number }}
  cancel-in-progress: true

jobs:
  call-reusable:
    uses: ./.github/workflows/reusable-deploy.yml
    with:
      envName: preview
      url: https://srv1051247.hstgr.cloud/summit-care-preview
      basePath: /summit-care-preview
      pm2Name: summitcare-preview
      port: 3002
      isPreview: true
      prNumber: ${{ github.event.pull_request.number }}
      dryRun: false
    secrets:
      DEPLOY_USER: ${{ secrets.DEPLOY_USER }}
      DEPLOY_HOST: ${{ secrets.DEPLOY_HOST }}
      APP_DIR: ${{ secrets.PREVIEW_DEPLOY_APP_DIR }}
      SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
      SSH_PORT: ${{ secrets.SSH_PORT }}
      KNOWN_HOSTS: ${{ secrets.KNOWN_HOSTS }}
