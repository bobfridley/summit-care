name: Deploy (staging)

on:
  push:
    branches: [develop]
  workflow_dispatch:

concurrency:
  group: deploy-staging-${{ github.ref }}
  cancel-in-progress: true

jobs:
  call-reusable:
    uses: ./.github/workflows/reusable-deploy.yml
    with:
      envName: staging
      url: https://srv1051247.hstgr.cloud/summit-care-staging
      basePath: /summit-care-staging
      pm2Name: summitcare-staging
      port: 3001
      branch: develop
      isPreview: false
      dryRun: true # flip to false when ready for real deploys
    secrets:
      DEPLOY_USER: ${{ secrets.DEPLOY_USER }}
      DEPLOY_HOST: ${{ secrets.DEPLOY_HOST }}
      APP_DIR: ${{ secrets.STAGING_DEPLOY_APP_DIR }}
      SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
      SSH_PORT: ${{ secrets.SSH_PORT }}
      KNOWN_HOSTS: ${{ secrets.KNOWN_HOSTS }}
