name: Deploy (prod)

on:
  workflow_run:
    workflows: ['CI']
    types: [completed]
    branches: [main]

concurrency:
  group: deploy-prod-${{ github.ref }}
  cancel-in-progress: true

jobs:
  call-reusable:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    uses: ./.github/workflows/reusable-deploy.yml
    with:
      envName: production
      url: https://srv1051247.hstgr.cloud/summit-care
      basePath: /summit-care
      pm2Name: summitcare
      port: 3000
      branch: main
      isPreview: false
      dryRun: false
    secrets:
      DEPLOY_USER: ${{ secrets.DEPLOY_USER }}
      DEPLOY_HOST: ${{ secrets.DEPLOY_HOST }}
      APP_DIR: ${{ secrets.DEPLOY_APP_DIR }}
      SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
      SSH_PORT: ${{ secrets.SSH_PORT }}
      KNOWN_HOSTS: ${{ secrets.KNOWN_HOSTS }}
